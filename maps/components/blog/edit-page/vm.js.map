{"version":3,"sources":["components/blog/edit-page/vm.js"],"names":["factory","define","ko","mapping","template","ctx","auth","url","alerts","modal","ViewModel","params","self","this","loaded","observable","model","notFound","updateRunning","updateListingRunning","authenticated","loginRedirect","blogs","getById","id","done","data","ArticleModel","submit","form","setTimeout","_arguments","arguments","args","toJS","update","then","load","resolve","info","console","log","toggleShowInListings","showInListings","showInResults","updateListed","success","err","showFileBrowser","fileBrowser","document","getElementById","addEventListener","e","detail","path","show","fromJS","cancelLink","viewLink","newLabel","prototype","addLabel","newValue","labels","push","value","toLowerCase","removeLabel","remove","viewModel"],"mappings":"AAAA,cAEA,SAAWA,GAIe,kBAAXC,SAAyBA,OAAY,KAC5CA,QAAQ,WAAY,mBAAoB,mBAAoB,wBAAyB,WAAY,UAAW,aAAc,oBAAqB,4BAA6B,iCAAkC,kCAAmCD,IAEtP,SAAUE,EAAIC,EAASC,EAAUC,EAAKC,EAAMC,EAAKC,EAAQC,GAIxD,QAASC,GAAUC,GAEf,GAAIC,GAAOC,IAEXD,GAAKE,OAASZ,EAAGa,YAAW,GAC5BH,EAAKI,MAAQd,EAAGa,aAChBH,EAAKK,SAAWf,EAAGa,aACnBH,EAAKM,cAAgBhB,EAAGa,YAAW,GACnCH,EAAKO,qBAAuBjB,EAAGa,YAAW,GAErCT,EAAKc,iBACNd,EAAKe,gBAGThB,EAAIiB,MAAMC,QAAQZ,EAAOa,IAAIC,KAAK,SAAUC,GAEpCA,EACAd,EAAKI,MAAM,GAAIW,GAAaD,IAE5Bd,EAAKK,UAAS,GAGlBL,EAAKE,QAAO,KAGhBF,EAAKgB,OAAS,SAAUC,GAEpBjB,EAAKM,eAAc,GAGnBY,WAAW,WACP,GAAIC,GAAaC,UAGbC,EAAO9B,EAAQ+B,KAAKtB,EAAKI,QAE7BX,GAAIiB,MAAMa,OAAOF,GAAMG,KAAK,WAExB7B,EAAI8B,KAAK9B,EAAI+B,QAAQ,SAAUL,EAAKT,KAEpChB,EAAO+B,KAAK,+BACb,WAECC,QAAQC,IAAI,iBAAkBV,GAE9BvB,EAAO+B,KAAK,qCACbH,KAAK,WAEJxB,EAAKM,eAAc,MAExB,MAGPN,EAAK8B,qBAAuB,WAExB,GAAI1B,GAAQJ,EAAKI,QACb2B,GAAkB3B,EAAM4B,eAE5BhC,GAAKO,sBAAqB,GAE1Bd,EAAIiB,MAAMuB,aAAa7B,EAAMQ,KAAMmB,GAAgBP,KAAK,WAEpDpB,EAAM4B,cAAcD,GACpBnC,EAAOsC,QAAQ,2BAA6BH,EAAiB,UAAY,UAAY,oDAAqD,YAC3I,SAAUI,GAETP,QAAQC,IAAIM,KACbX,KAAK,WAEJxB,EAAKO,sBAAqB,MAIlCP,EAAKoC,gBAAkB,WACnB,GAAIC,GAAcC,SAASC,eAAe,cAC1CF,GAAYG,iBAAiB,gBAAiB,SAAUC,GACpD7C,EAAO+B,KAAKc,EAAEC,OAAOC,QAEzB9C,EAAM+C,KAAKP,IAInB,QAAStB,GAAaD,GAElBvB,EAAQsD,OAAO/B,KAAUb,MAEzBA,KAAK6C,WAAahC,EAAKiC,SACvB9C,KAAK+C,SAAW1D,EAAGa,WAAW,MAkBlC,MAfAY,GAAakC,UAAUC,SAAW,WAE9B,GAAIC,GAAWlD,KAAK+C,UAEdG,KACFlD,KAAKmD,OAAOC,MAAOzC,GAAI,KAAM0C,MAAOH,EAASI,gBAC7CtD,KAAK+C,SAAS,QAItBjC,EAAakC,UAAUO,YAAc,SAAU1C,GAE3Cb,KAAKmD,OAAOK,OAAO3C,KAInB4C,UAAW5D,EACXN,SAAUA","file":"components/blog/edit-page/vm.js","sourcesContent":["'use strict';\n\n(function (factory) {\n\n    \"use strict\";\n\n    if (typeof define === 'function' && define['amd']) {\n        define(['knockout', 'knockout-mapping', 'text!./view.html', 'app/data-context-blog', 'lib/auth', 'lib/url', 'lib/alerts', 'vendor/lski-modal', 'lib/knockout-bindings-ext', 'lib/knockout-bindings-datetime', 'lib/knockout-bindings-richText'], factory);\n    }\n})(function (ko, mapping, template, ctx, auth, url, alerts, modal) {\n\n    \"use strict\";\n\n    function ViewModel(params) {\n\n        var self = this;\n\n        self.loaded = ko.observable(false);\n        self.model = ko.observable();\n        self.notFound = ko.observable();\n        self.updateRunning = ko.observable(false);\n        self.updateListingRunning = ko.observable(false);\n\n        if (!auth.authenticated()) {\n            auth.loginRedirect();\n        }\n\n        ctx.blogs.getById(params.id).done(function (data) {\n\n            if (data) {\n                self.model(new ArticleModel(data));\n            } else {\n                self.notFound(true);\n            }\n\n            self.loaded(true);\n        });\n\n        self.submit = function (form) {\n\n            self.updateRunning(true);\n\n            // Todo: fix this timeout issue\n            setTimeout(function () {\n                var _arguments = arguments;\n\n\n                var args = mapping.toJS(self.model());\n\n                ctx.blogs.update(args).then(function () {\n\n                    url.load(url.resolve('#blog/', args.id));\n\n                    alerts.info('Article successfully saved');\n                }, function () {\n\n                    console.log('Error occurred', _arguments);\n\n                    alerts.info('There was an saving the article');\n                }).then(function () {\n\n                    self.updateRunning(false);\n                });\n            }, 200);\n        };\n\n        self.toggleShowInListings = function () {\n\n            var model = self.model(),\n                showInListings = !model.showInResults();\n\n            self.updateListingRunning(true);\n\n            ctx.blogs.updateListed(model.id(), showInListings).then(function () {\n\n                model.showInResults(showInListings);\n                alerts.success(\"This is article is now \" + (showInListings ? 'visible' : 'hidden') + ' in listings. You do not need to save the article', 'Success');\n            }, function (err) {\n\n                console.log(err);\n            }).then(function () {\n\n                self.updateListingRunning(false);\n            });\n        };\n\n        self.showFileBrowser = function () {\n            var fileBrowser = document.getElementById(\"fileBrowser\");\n            fileBrowser.addEventListener('file-selected', function (e) {\n                alerts.info(e.detail.path);\n            });\n            modal.show(fileBrowser);\n        };\n    }\n\n    function ArticleModel(data) {\n\n        mapping.fromJS(data, {}, this);\n\n        this.cancelLink = data.viewLink;\n        this.newLabel = ko.observable(null);\n    }\n\n    ArticleModel.prototype.addLabel = function () {\n\n        var newValue = this.newLabel();\n\n        if (!!newValue) {\n            this.labels.push({ id: null, value: newValue.toLowerCase() });\n            this.newLabel(null);\n        }\n    };\n\n    ArticleModel.prototype.removeLabel = function (data) {\n\n        this.labels.remove(data);\n    };\n\n    return {\n        viewModel: ViewModel,\n        template: template\n    };\n});"],"sourceRoot":"/source/"}