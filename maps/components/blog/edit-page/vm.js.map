{"version":3,"sources":["components/blog/edit-page/vm.js"],"names":["factory","define","ko","mapping","template","ctx","auth","url","alerts","ViewModel","params","self","this","loaded","observable","model","notFound","updateRunning","updateListingRunning","fileBrowser","authenticated","loginRedirect","blogs","getById","id","done","data","ArticleModel","submit","form","setTimeout","_arguments","arguments","args","toJS","update","then","load","resolve","info","console","log","toggleShowInListings","showInListings","showInResults","updateListed","success","err","showFileBrowser","fileBrowserClosed","fromJS","cancelLink","viewLink","newLabel","prototype","addLabel","newValue","labels","push","value","toLowerCase","removeLabel","remove","viewModel"],"mappings":"AAAA,cAEA,SAAWA,GAIe,kBAAXC,SAAyBA,OAAY,KAC5CA,QAAQ,WAAY,mBAAoB,mBAAoB,wBAAyB,WAAY,UAAW,aAAc,4BAA6B,iCAAkC,kCAAmC,SAAUC,EAAIC,EAASC,EAAUC,EAAKC,EAAMC,EAAKC,GACzQ,MAAOR,GAAQE,EAAIC,EAASC,EAAUC,EAAKC,EAAMC,EAAKC,MAG/D,SAAUN,EAAIC,EAASC,EAAUC,EAAKC,EAAMC,EAAKC,GAIhD,QAASC,GAAUC,GAEf,GAAIC,GAAOC,IAEXD,GAAKE,OAASX,EAAGY,YAAW,GAC5BH,EAAKI,MAAQb,EAAGY,aAChBH,EAAKK,SAAWd,EAAGY,aACnBH,EAAKM,cAAgBf,EAAGY,YAAW,GACnCH,EAAKO,qBAAuBhB,EAAGY,YAAW,GAC1CH,EAAKQ,YAAcjB,EAAGY,YAAW,GAE5BR,EAAKc,iBACNd,EAAKe,gBAGThB,EAAIiB,MAAMC,QAAQb,EAAOc,IAAIC,KAAK,SAAUC,GAEpCA,EACAf,EAAKI,MAAM,GAAIY,GAAaD,IAE5Bf,EAAKK,UAAS,GAGlBL,EAAKE,QAAO,KAGhBF,EAAKiB,OAAS,SAAUC,GAEpBlB,EAAKM,eAAc,GAGnBa,WAAW,WACP,GAAIC,GAAaC,UAGbC,EAAO9B,EAAQ+B,KAAKvB,EAAKI,QAE7BV,GAAIiB,MAAMa,OAAOF,GAAMG,KAAK,WAExB7B,EAAI8B,KAAK9B,EAAI+B,QAAQ,SAAUL,EAAKT,KAEpChB,EAAO+B,KAAK,+BACb,WAECC,QAAQC,IAAI,iBAAkBV,GAE9BvB,EAAO+B,KAAK,qCACbH,KAAK,WAEJzB,EAAKM,eAAc,MAExB,MAGPN,EAAK+B,qBAAuB,WAExB,GAAI3B,GAAQJ,EAAKI,QACb4B,GAAkB5B,EAAM6B,eAE5BjC,GAAKO,sBAAqB,GAE1Bb,EAAIiB,MAAMuB,aAAa9B,EAAMS,KAAMmB,GAAgBP,KAAK,WAEpDrB,EAAM6B,cAAcD,GACpBnC,EAAOsC,QAAQ,2BAA6BH,EAAiB,UAAY,UAAY,oDAAqD,YAC3I,SAAUI,GAETP,QAAQC,IAAIM,KACbX,KAAK,WAEJzB,EAAKO,sBAAqB,MAIlCP,EAAKqC,gBAAkB,WACnBrC,EAAKQ,aAAY,IAGrBR,EAAKsC,kBAAoB,WACrBtC,EAAKQ,aAAY,IAIzB,QAASQ,GAAaD,GAElBvB,EAAQ+C,OAAOxB,KAAUd,MAEzBA,KAAKuC,WAAazB,EAAK0B,SACvBxC,KAAKyC,SAAWnD,EAAGY,WAAW,MAkBlC,MAfAa,GAAa2B,UAAUC,SAAW,WAE9B,GAAIC,GAAW5C,KAAKyC,UAEdG,KACF5C,KAAK6C,OAAOC,MAAOlC,GAAI,KAAMmC,MAAOH,EAASI,gBAC7ChD,KAAKyC,SAAS,QAItB1B,EAAa2B,UAAUO,YAAc,SAAUnC,GAE3Cd,KAAK6C,OAAOK,OAAOpC,KAInBqC,UAAWtD,EACXL,SAAUA","file":"components/blog/edit-page/vm.js","sourcesContent":["'use strict';\n\n(function (factory) {\n\n    \"use strict\";\n\n    if (typeof define === 'function' && define['amd']) {\n        define(['knockout', 'knockout-mapping', 'text!./view.html', 'app/data-context-blog', 'lib/auth', 'lib/url', 'lib/alerts', 'lib/knockout-bindings-ext', 'lib/knockout-bindings-datetime', 'lib/knockout-bindings-richText'], function (ko, mapping, template, ctx, auth, url, alerts) {\n            return factory(ko, mapping, template, ctx, auth, url, alerts);\n        });\n    }\n})(function (ko, mapping, template, ctx, auth, url, alerts) {\n\n    \"use strict\";\n\n    function ViewModel(params) {\n\n        var self = this;\n\n        self.loaded = ko.observable(false);\n        self.model = ko.observable();\n        self.notFound = ko.observable();\n        self.updateRunning = ko.observable(false);\n        self.updateListingRunning = ko.observable(false);\n        self.fileBrowser = ko.observable(false);\n\n        if (!auth.authenticated()) {\n            auth.loginRedirect();\n        }\n\n        ctx.blogs.getById(params.id).done(function (data) {\n\n            if (data) {\n                self.model(new ArticleModel(data));\n            } else {\n                self.notFound(true);\n            }\n\n            self.loaded(true);\n        });\n\n        self.submit = function (form) {\n\n            self.updateRunning(true);\n\n            // Todo: fix this timeout issue\n            setTimeout(function () {\n                var _arguments = arguments;\n\n\n                var args = mapping.toJS(self.model());\n\n                ctx.blogs.update(args).then(function () {\n\n                    url.load(url.resolve('#blog/', args.id));\n\n                    alerts.info('Article successfully saved');\n                }, function () {\n\n                    console.log('Error occurred', _arguments);\n\n                    alerts.info('There was an saving the article');\n                }).then(function () {\n\n                    self.updateRunning(false);\n                });\n            }, 200);\n        };\n\n        self.toggleShowInListings = function () {\n\n            var model = self.model(),\n                showInListings = !model.showInResults();\n\n            self.updateListingRunning(true);\n\n            ctx.blogs.updateListed(model.id(), showInListings).then(function () {\n\n                model.showInResults(showInListings);\n                alerts.success(\"This is article is now \" + (showInListings ? 'visible' : 'hidden') + ' in listings. You do not need to save the article', 'Success');\n            }, function (err) {\n\n                console.log(err);\n            }).then(function () {\n\n                self.updateListingRunning(false);\n            });\n        };\n\n        self.showFileBrowser = function () {\n            self.fileBrowser(true);\n        };\n\n        self.fileBrowserClosed = function () {\n            self.fileBrowser(false);\n        };\n    }\n\n    function ArticleModel(data) {\n\n        mapping.fromJS(data, {}, this);\n\n        this.cancelLink = data.viewLink;\n        this.newLabel = ko.observable(null);\n    }\n\n    ArticleModel.prototype.addLabel = function () {\n\n        var newValue = this.newLabel();\n\n        if (!!newValue) {\n            this.labels.push({ id: null, value: newValue.toLowerCase() });\n            this.newLabel(null);\n        }\n    };\n\n    ArticleModel.prototype.removeLabel = function (data) {\n\n        this.labels.remove(data);\n    };\n\n    return {\n        viewModel: ViewModel,\n        template: template\n    };\n});"],"sourceRoot":"/source/"}