{"version":3,"sources":["components/blog/edit-page/vm.js"],"names":["factory","define","ko","mapping","template","module","ctx","auth","url","alerts","modal","config","ViewModel","params","self","this","loaded","observable","model","notFound","updateRunning","updateListingRunning","fileBrowser","authenticated","loginRedirect","blogs","getById","id","done","data","ArticleModel","submit","form","setTimeout","_arguments","arguments","args","toJS","update","then","load","resolve","info","console","log","toggleShowInListings","showInListings","showInResults","updateListed","success","err","showFileBrowser","ele","document","querySelector","src","_browserUrl","onload","contentWindow","Run","apiUrl","resolveApi","token","show","fromJS","cancelLink","viewLink","newLabel","browserUrl","prototype","addLabel","newValue","labels","push","value","toLowerCase","removeLabel","remove","viewModel"],"mappings":"AAAA,cAEA,SAAWA,GAIe,kBAAXC,SAAyBA,OAAY,KAC5CA,QAAQ,WAAY,mBAAoB,mBAAoB,SAAU,wBAAyB,WAAY,UAAW,aAAc,oBAAqB,4BAA6B,iCAAkC,iCAAkC,gCAAiC,SAAUC,EAAIC,EAASC,EAAUC,EAAQC,EAAKC,EAAMC,EAAKC,EAAQC,GACxV,MAAOV,GAAQE,EAAIC,EAASC,EAAUC,EAAOM,SAAUL,EAAKC,EAAMC,EAAKC,EAAQC,MAGxF,SAAUR,EAAIC,EAASC,EAAUO,EAAQL,EAAKC,EAAMC,EAAKC,EAAQC,GAMhE,QAASE,GAAUC,GAEf,GAAIC,GAAOC,IAEXD,GAAKE,OAASd,EAAGe,YAAW,GAC5BH,EAAKI,MAAQhB,EAAGe,aAChBH,EAAKK,SAAWjB,EAAGe,aACnBH,EAAKM,cAAgBlB,EAAGe,YAAW,GACnCH,EAAKO,qBAAuBnB,EAAGe,YAAW,GAC1CH,EAAKQ,YAAcpB,EAAGe,WAAW,MAE5BV,EAAKgB,iBACNhB,EAAKiB,gBAGTlB,EAAImB,MAAMC,QAAQb,EAAOc,IAAIC,KAAK,SAAUC,GAEpCA,EACAf,EAAKI,MAAM,GAAIY,GAAaD,IAE5Bf,EAAKK,UAAS,GAGlBL,EAAKE,QAAO,KAGhBF,EAAKiB,OAAS,SAAUC,GAEpBlB,EAAKM,eAAc,GAGnBa,WAAW,WACP,GAAIC,GAAaC,UAGbC,EAAOjC,EAAQkC,KAAKvB,EAAKI,QAE7BZ,GAAImB,MAAMa,OAAOF,GAAMG,KAAK,WAExB/B,EAAIgC,KAAKhC,EAAIiC,QAAQ,SAAUL,EAAKT,KAEpClB,EAAOiC,KAAK,+BACb,WAECC,QAAQC,IAAI,iBAAkBV,GAE9BzB,EAAOiC,KAAK,qCACbH,KAAK,WAEJzB,EAAKM,eAAc,MAExB,MAGPN,EAAK+B,qBAAuB,WAExB,GAAI3B,GAAQJ,EAAKI,QACb4B,GAAkB5B,EAAM6B,eAE5BjC,GAAKO,sBAAqB,GAE1Bf,EAAImB,MAAMuB,aAAa9B,EAAMS,KAAMmB,GAAgBP,KAAK,WAEpDrB,EAAM6B,cAAcD,GACpBrC,EAAOwC,QAAQ,2BAA6BH,EAAiB,UAAY,UAAY,oDAAqD,YAC3I,SAAUI,GAETP,QAAQC,IAAIM,KACbX,KAAK,WAEJzB,EAAKO,sBAAqB,MAIlCP,EAAKqC,gBAAkB,WAEnB,GAAIC,GAAMC,SAASC,cAAc,eAEjCxC,GAAKQ,aACDiC,IAAK/C,EAAIiC,QAAQe,GACjBC,OAAQ,YAEH1C,KAAK2C,eAAiB3C,MAAM4C,KACzBC,OAAQpD,EAAIqD,WAAW,IACvBC,MAAOvD,EAAKuD,WAKxBpD,EAAMqD,KAAKX,IAInB,QAAStB,GAAaD,GAElB1B,EAAQ6D,OAAOnC,KAAUd,MAEzBA,KAAKkD,WAAapC,EAAKqC,SACvBnD,KAAKoD,SAAWjE,EAAGe,WAAW,MApGlC,GAAIuC,GAAc7C,EAAOyD,YAAc,oBAsHvC,OAfAtC,GAAauC,UAAUC,SAAW,WAE9B,GAAIC,GAAWxD,KAAKoD,UAEdI,KACFxD,KAAKyD,OAAOC,MAAO9C,GAAI,KAAM+C,MAAOH,EAASI,gBAC7C5D,KAAKoD,SAAS,QAItBrC,EAAauC,UAAUO,YAAc,SAAU/C,GAE3Cd,KAAKyD,OAAOK,OAAOhD,KAInBiD,UAAWlE,EACXR,SAAUA","file":"components/blog/edit-page/vm.js","sourcesContent":["'use strict';\n\n(function (factory) {\n\n    \"use strict\";\n\n    if (typeof define === 'function' && define['amd']) {\n        define(['knockout', 'knockout-mapping', 'text!./view.html', 'module', 'app/data-context-blog', 'lib/auth', 'lib/url', 'lib/alerts', 'vendor/lski-modal', 'lib/knockout-bindings-ext', 'lib/knockout-bindings-datetime', 'lib/knockout-bindings-richText', 'lib/knockout-bindings-iframe'], function (ko, mapping, template, module, ctx, auth, url, alerts, modal) {\n            return factory(ko, mapping, template, module.config(), ctx, auth, url, alerts, modal);\n        });\n    }\n})(function (ko, mapping, template, config, ctx, auth, url, alerts, modal) {\n\n    \"use strict\";\n\n    var _browserUrl = config.browserUrl || \"/browser/index.htm\";\n\n    function ViewModel(params) {\n\n        var self = this;\n\n        self.loaded = ko.observable(false);\n        self.model = ko.observable();\n        self.notFound = ko.observable();\n        self.updateRunning = ko.observable(false);\n        self.updateListingRunning = ko.observable(false);\n        self.fileBrowser = ko.observable(null);\n\n        if (!auth.authenticated()) {\n            auth.loginRedirect();\n        }\n\n        ctx.blogs.getById(params.id).done(function (data) {\n\n            if (data) {\n                self.model(new ArticleModel(data));\n            } else {\n                self.notFound(true);\n            }\n\n            self.loaded(true);\n        });\n\n        self.submit = function (form) {\n\n            self.updateRunning(true);\n\n            // Todo: fix this timeout issue\n            setTimeout(function () {\n                var _arguments = arguments;\n\n\n                var args = mapping.toJS(self.model());\n\n                ctx.blogs.update(args).then(function () {\n\n                    url.load(url.resolve('#blog/', args.id));\n\n                    alerts.info('Article successfully saved');\n                }, function () {\n\n                    console.log('Error occurred', _arguments);\n\n                    alerts.info('There was an saving the article');\n                }).then(function () {\n\n                    self.updateRunning(false);\n                });\n            }, 200);\n        };\n\n        self.toggleShowInListings = function () {\n\n            var model = self.model(),\n                showInListings = !model.showInResults();\n\n            self.updateListingRunning(true);\n\n            ctx.blogs.updateListed(model.id(), showInListings).then(function () {\n\n                model.showInResults(showInListings);\n                alerts.success(\"This is article is now \" + (showInListings ? 'visible' : 'hidden') + ' in listings. You do not need to save the article', 'Success');\n            }, function (err) {\n\n                console.log(err);\n            }).then(function () {\n\n                self.updateListingRunning(false);\n            });\n        };\n\n        self.showFileBrowser = function () {\n\n            var ele = document.querySelector('#fileBrowser');\n\n            self.fileBrowser({\n                src: url.resolve(_browserUrl),\n                onload: function onload() {\n\n                    (this.contentWindow || this).Run({\n                        apiUrl: url.resolveApi(\"\"),\n                        token: auth.token\n                    });\n                }\n            });\n\n            modal.show(ele);\n        };\n    }\n\n    function ArticleModel(data) {\n\n        mapping.fromJS(data, {}, this);\n\n        this.cancelLink = data.viewLink;\n        this.newLabel = ko.observable(null);\n    }\n\n    ArticleModel.prototype.addLabel = function () {\n\n        var newValue = this.newLabel();\n\n        if (!!newValue) {\n            this.labels.push({ id: null, value: newValue.toLowerCase() });\n            this.newLabel(null);\n        }\n    };\n\n    ArticleModel.prototype.removeLabel = function (data) {\n\n        this.labels.remove(data);\n    };\n\n    return {\n        viewModel: ViewModel,\n        template: template\n    };\n});"],"sourceRoot":"/source/"}