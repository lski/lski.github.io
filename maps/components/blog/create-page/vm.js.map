{"version":3,"sources":["components/blog/create-page/vm.js"],"names":["define","ko","mapping","template","ctx","auth","url","alerts","ViewModel","self","this","loaded","observable","model","authenticated","running","fileBrowser","blogs","getDefault","done","data","ArticleModel","submit","form","setTimeout","args","toJS","create","then","blog","load","resolve","id","info","console","log","arguments","showFileBrowser","fileBrowserClosed","fromJS","cancelLnk","hasLabels","pureComputed","labels","length","newLabel","prototype","addLabel","newValue","push","value","toLowerCase","removeLabel","remove","viewModel"],"mappings":"AAAA,YAEAA,SAAQ,WAAY,mBAAoB,mBAAoB,wBAAyB,WAAY,UAAW,aAAc,4BAA6B,iCAAkC,kCAAmC,SAAUC,EAAIC,EAASC,EAAUC,EAAKC,EAAMC,EAAKC,GAIzQ,QAASC,KAEL,GAAIC,GAAOC,IAEXD,GAAKE,OAASV,EAAGW,YAAW,GAC5BH,EAAKI,MAAQZ,EAAGW,aAChBH,EAAKK,cAAgBb,EAAGW,WAAWP,EAAKS,iBACxCL,EAAKM,QAAUd,EAAGW,YAAW,GAC7BH,EAAKO,YAAcf,EAAGW,YAAW,GAEjCR,EAAIa,MAAMC,aAAaC,KAAK,SAAUC,GAElCX,EAAKI,MAAM,GAAIQ,GAAaD,IAE5BX,EAAKE,QAAO,KAGhBF,EAAKa,OAAS,SAAUC,GAEpBd,EAAKM,SAAQ,GAGbS,WAAW,WAEP,GAAIC,GAAOvB,EAAQwB,KAAKjB,EAAKI,QAE7BT,GAAIa,MAAMU,OAAOF,GAAMG,KAAK,SAAUC,GAElCvB,EAAIwB,KAAKxB,EAAIyB,QAAQ,SAAUF,EAAKG,KAEpCvB,EAAKM,SAAQ,GAEbR,EAAO0B,KAAK,gCACb,SAAS,WAERC,QAAQC,IAAI,iBAAkBC,WAE9B7B,EAAO0B,KAAK,qCACbL,KAAK,WAEJnB,EAAKM,SAAQ,MAElB,MAGPN,EAAK4B,gBAAkB,WACnB5B,EAAKO,aAAY,IAGrBP,EAAK6B,kBAAoB,WACrB7B,EAAKO,aAAY,IAIzB,QAASK,GAAaD,GAElBlB,EAAQqC,OAAOnB,KAAUV,MAEzBA,KAAK8B,UAAY,SACjB9B,KAAK+B,UAAYxC,EAAGyC,aAAa,WAC7B,MAAgC,KAAzBhC,KAAKiC,SAASC,SAEzBlC,KAAKmC,SAAW5C,EAAGW,WAAW,MAkBlC,MAfAS,GAAayB,UAAUC,SAAW,WAE9B,GAAIC,GAAWtC,KAAKmC,UAEdG,KACFtC,KAAKiC,OAAOM,MAAOjB,GAAI,KAAMkB,MAAOF,EAASG,gBAC7CzC,KAAKmC,SAAS,QAItBxB,EAAayB,UAAUM,YAAc,SAAUhC,GAE3CV,KAAKiC,OAAOU,OAAOjC,KAInBkC,UAAW9C,EACXL,SAAUA","file":"../../../../components/blog/create-page/vm.js","sourcesContent":["'use strict';\n\ndefine(['knockout', 'knockout-mapping', 'text!./view.html', 'app/data-context-blog', 'lib/auth', 'lib/url', 'lib/alerts', 'lib/knockout-bindings-ext', 'lib/knockout-bindings-datetime', 'lib/knockout-bindings-richText'], function (ko, mapping, template, ctx, auth, url, alerts) {\n\n    \"use strict\";\n\n    function ViewModel() {\n\n        var self = this;\n\n        self.loaded = ko.observable(false);\n        self.model = ko.observable();\n        self.authenticated = ko.observable(auth.authenticated());\n        self.running = ko.observable(false);\n        self.fileBrowser = ko.observable(false);\n\n        ctx.blogs.getDefault().done(function (data) {\n\n            self.model(new ArticleModel(data));\n\n            self.loaded(true);\n        });\n\n        self.submit = function (form) {\n\n            self.running(true);\n\n            // Todo: fix this timeout issue\n            setTimeout(function () {\n\n                var args = mapping.toJS(self.model());\n\n                ctx.blogs.create(args).then(function (blog) {\n\n                    url.load(url.resolve('#blog/', blog.id));\n\n                    self.running(false);\n\n                    alerts.info('Article successfully saved');\n                })['catch'](function () {\n\n                    console.log('Error occurred', arguments);\n\n                    alerts.info('There was an saving the article');\n                }).then(function () {\n\n                    self.running(false);\n                });\n            }, 100);\n        };\n\n        self.showFileBrowser = function () {\n            self.fileBrowser(true);\n        };\n\n        self.fileBrowserClosed = function () {\n            self.fileBrowser(false);\n        };\n    }\n\n    function ArticleModel(data) {\n\n        mapping.fromJS(data, {}, this);\n\n        this.cancelLnk = '#blogs';\n        this.hasLabels = ko.pureComputed(function () {\n            return this.labels().length !== 0;\n        });\n        this.newLabel = ko.observable(null);\n    }\n\n    ArticleModel.prototype.addLabel = function () {\n\n        var newValue = this.newLabel();\n\n        if (!!newValue) {\n            this.labels.push({ id: null, value: newValue.toLowerCase() });\n            this.newLabel(null);\n        }\n    };\n\n    ArticleModel.prototype.removeLabel = function (data) {\n\n        this.labels.remove(data);\n    };\n\n    return {\n        viewModel: ViewModel,\n        template: template\n    };\n});"]}