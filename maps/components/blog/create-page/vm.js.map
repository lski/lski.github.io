{"version":3,"sources":["components/blog/create-page/vm.js"],"names":["factory","define","ko","mapping","template","ctx","auth","url","alerts","ViewModel","self","this","loaded","observable","model","authenticated","running","blogs","getDefault","done","data","ArticleModel","submit","form","setTimeout","args","toJS","create","then","blog","load","resolve","id","info","console","log","arguments","fromJS","cancelLnk","hasLabels","pureComputed","labels","length","newLabel","prototype","addLabel","newValue","push","value","toLowerCase","removeLabel","remove","viewModel"],"mappings":"AAAA,cAEA,SAAWA,GAIe,kBAAXC,SAAyBA,OAAY,KAC5CA,QAAQ,WAAY,mBAAoB,mBAAoB,wBAAyB,WAAY,UAAW,aAAc,4BAA6B,iCAAkC,kCAAmCD,IAEjO,SAAUE,EAAIC,EAASC,EAAUC,EAAKC,EAAMC,EAAKC,GAIhD,QAASC,KAEL,GAAIC,GAAOC,IAEXD,GAAKE,OAASV,EAAGW,YAAW,GAC5BH,EAAKI,MAAQZ,EAAGW,aAChBH,EAAKK,cAAgBb,EAAGW,WAAWP,EAAKS,iBACxCL,EAAKM,QAAUd,EAAGW,YAAW,GAE7BR,EAAIY,MAAMC,aAAaC,KAAK,SAAUC,GAElCV,EAAKI,MAAM,GAAIO,GAAaD,IAE5BV,EAAKE,QAAO,KAGhBF,EAAKY,OAAS,SAAUC,GAEpBb,EAAKM,SAAQ,GAGbQ,WAAW,WAEP,GAAIC,GAAOtB,EAAQuB,KAAKhB,EAAKI,QAE7BT,GAAIY,MAAMU,OAAOF,GAAMG,KAAK,SAAUC,GAElCtB,EAAIuB,KAAKvB,EAAIwB,QAAQ,SAAUF,EAAKG,KAEpCtB,EAAKM,SAAQ,GAEbR,EAAOyB,KAAK,gCACb,SAAS,WAERC,QAAQC,IAAI,iBAAkBC,WAE9B5B,EAAOyB,KAAK,qCACbL,KAAK,WAEJlB,EAAKM,SAAQ,MAElB,MAIX,QAASK,GAAaD,GAElBjB,EAAQkC,OAAOjB,KAAUT,MAEzBA,KAAK2B,UAAY,SACjB3B,KAAK4B,UAAYrC,EAAGsC,aAAa,WAC7B,MAAgC,KAAzB7B,KAAK8B,SAASC,SAEzB/B,KAAKgC,SAAWzC,EAAGW,WAAW,MAkBlC,MAfAQ,GAAauB,UAAUC,SAAW,WAE9B,GAAIC,GAAWnC,KAAKgC,UAEdG,KACFnC,KAAK8B,OAAOM,MAAOf,GAAI,KAAMgB,MAAOF,EAASG,gBAC7CtC,KAAKgC,SAAS,QAItBtB,EAAauB,UAAUM,YAAc,SAAU9B,GAE3CT,KAAK8B,OAAOU,OAAO/B,KAInBgC,UAAW3C,EACXL,SAAUA","file":"components/blog/create-page/vm.js","sourcesContent":["'use strict';\n\n(function (factory) {\n\n    \"use strict\";\n\n    if (typeof define === 'function' && define['amd']) {\n        define(['knockout', 'knockout-mapping', 'text!./view.html', 'app/data-context-blog', 'lib/auth', 'lib/url', 'lib/alerts', 'lib/knockout-bindings-ext', 'lib/knockout-bindings-datetime', 'lib/knockout-bindings-richText'], factory);\n    }\n})(function (ko, mapping, template, ctx, auth, url, alerts) {\n\n    \"use strict\";\n\n    function ViewModel() {\n\n        var self = this;\n\n        self.loaded = ko.observable(false);\n        self.model = ko.observable();\n        self.authenticated = ko.observable(auth.authenticated());\n        self.running = ko.observable(false);\n\n        ctx.blogs.getDefault().done(function (data) {\n\n            self.model(new ArticleModel(data));\n\n            self.loaded(true);\n        });\n\n        self.submit = function (form) {\n\n            self.running(true);\n\n            // Todo: fix this timeout issue\n            setTimeout(function () {\n\n                var args = mapping.toJS(self.model());\n\n                ctx.blogs.create(args).then(function (blog) {\n\n                    url.load(url.resolve('#blog/', blog.id));\n\n                    self.running(false);\n\n                    alerts.info('Article successfully saved');\n                })['catch'](function () {\n\n                    console.log('Error occurred', arguments);\n\n                    alerts.info('There was an saving the article');\n                }).then(function () {\n\n                    self.running(false);\n                });\n            }, 100);\n        };\n    }\n\n    function ArticleModel(data) {\n\n        mapping.fromJS(data, {}, this);\n\n        this.cancelLnk = '#blogs';\n        this.hasLabels = ko.pureComputed(function () {\n            return this.labels().length !== 0;\n        });\n        this.newLabel = ko.observable(null);\n    }\n\n    ArticleModel.prototype.addLabel = function () {\n\n        var newValue = this.newLabel();\n\n        if (!!newValue) {\n            this.labels.push({ id: null, value: newValue.toLowerCase() });\n            this.newLabel(null);\n        }\n    };\n\n    ArticleModel.prototype.removeLabel = function (data) {\n\n        this.labels.remove(data);\n    };\n\n    return {\n        viewModel: ViewModel,\n        template: template\n    };\n});"],"sourceRoot":"/source/"}