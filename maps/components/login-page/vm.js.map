{"version":3,"sources":["components/login-page/vm.js"],"names":["define","template","ko","auth","ctx","ViewModel","self","this","model","Model","message","observable","running","submit","form","response","login","email","password","then","access_token","expires_in","transferRedirect","error","obj","JSON","parse","xhr","responseText","error_description","e","viewModel"],"mappings":"AAAA,YAEAA,SAAQ,mBAAoB,WAAY,WAAY,yBAA0B,SAAUC,EAAUC,EAAIC,EAAMC,GAIxG,QAASC,KAEL,GAAIC,GAAOC,IAEXA,MAAKC,MAAQ,GAAIC,GAEjBF,KAAKG,QAAUR,EAAGS,aAClBJ,KAAKK,QAAUV,EAAGS,YAAW,GAE7BL,EAAKO,OAAS,SAAUC,GAQpBR,EAAKM,SAAQ,EAEb,IAAIG,GAAWX,EAAIY,MAAMT,KAAKU,QAASV,KAAKW,WAE5CH,GAASI,KAAK,SAAUJ,GAEpBZ,EAAKa,MAAMD,EAASK,gBAAkBL,EAASM,YAC/ClB,EAAKmB,mBAELhB,EAAKI,QAAQ,QACd,SAAS,SAAUa,GAElB,IAEI,GAAIC,GAAMC,KAAKC,MAAMH,EAAMI,IAAIC,aAC/BtB,GAAKI,QAAQc,EAAIK,mBAAqBL,EAAId,SAC5C,MAAOoB,GACLxB,EAAKI,QAAQ,gEAElBS,KAAK,WAEJb,EAAKM,SAAQ,MAKzB,QAASH,KAELF,KAAKU,MAAQf,EAAGS,aAChBJ,KAAKW,SAAWhB,EAAGS,aAGvB,OACIoB,UAAW1B,EACXJ,SAAUA","file":"../../../components/login-page/vm.js","sourcesContent":["'use strict';\n\ndefine(['text!./view.html', 'knockout', 'lib/auth', 'app/data-context-auth'], function (template, ko, auth, ctx) {\n\n    \"use strict\";\n\n    function ViewModel() {\n\n        var self = this;\n\n        this.model = new Model();\n\n        this.message = ko.observable();\n        this.running = ko.observable(false);\n\n        self.submit = function (form) {\n\n            var args = this;\n\n            //if (!validate.valid(args, form)) {\n            //    return;\n            //}\n\n            self.running(true);\n\n            var response = ctx.login(this.email(), this.password());\n\n            response.then(function (response) {\n\n                auth.login(response.access_token, {}, response.expires_in);\n                auth.transferRedirect();\n\n                self.message(null);\n            })['catch'](function (error) {\n\n                try {\n\n                    var obj = JSON.parse(error.xhr.responseText);\n                    self.message(obj.error_description || obj.message);\n                } catch (e) {\n                    self.message('Sorry an error occured, please contact your administrator');\n                }\n            }).then(function () {\n\n                self.running(false);\n            });\n        };\n    }\n\n    function Model() {\n\n        this.email = ko.observable();\n        this.password = ko.observable();\n    }\n\n    return {\n        viewModel: ViewModel,\n        template: template\n    };\n});"]}