{"version":3,"sources":["components/login-page/vm.js"],"names":["factory","define","template","ko","auth","ctx","validate","ViewModel","self","this","model","Model","message","observable","running","submit","form","response","login","email","password","then","access_token","expires_in","transferRedirect","error","obj","JSON","parse","xhr","responseText","error_description","e","viewModel"],"mappings":"AAAA,cAEA,SAAWA,GAIe,kBAAXC,SAAyBA,OAAY,KAC5CA,QAAQ,mBAAoB,WAAY,WAAY,yBAA0BD,IAEnF,SAAUE,EAAUC,EAAIC,EAAMC,EAAKC,GAIlC,QAASC,KAEL,GAAIC,GAAOC,IAEXA,MAAKC,MAAQ,GAAIC,GAEjBF,KAAKG,QAAUT,EAAGU,aAClBJ,KAAKK,QAAUX,EAAGU,YAAW,GAE7BL,EAAKO,OAAS,SAAUC,GAQpBR,EAAKM,SAAQ,EAEb,IAAIG,GAAWZ,EAAIa,MAAMT,KAAKU,QAASV,KAAKW,WAE5CH,GAASI,KAAK,SAAUJ,GAEpBb,EAAKc,MAAMD,EAASK,gBAAkBL,EAASM,YAC/CnB,EAAKoB,mBAELhB,EAAKI,QAAQ,QACd,SAAS,SAAUa,GAElB,IAEI,GAAIC,GAAMC,KAAKC,MAAMH,EAAMI,IAAIC,aAC/BtB,GAAKI,QAAQc,EAAIK,mBAAqBL,EAAId,SAC5C,MAAOoB,GACLxB,EAAKI,QAAQ,gEAElBS,KAAK,WAEJb,EAAKM,SAAQ,MAKzB,QAASH,KAELF,KAAKU,MAAQhB,EAAGU,aAChBJ,KAAKW,SAAWjB,EAAGU,aAGvB,OACIoB,UAAW1B,EACXL,SAAUA","file":"components/login-page/vm.js","sourcesContent":["'use strict';\n\n(function (factory) {\n\n    \"use strict\";\n\n    if (typeof define === 'function' && define['amd']) {\n        define(['text!./view.html', 'knockout', 'lib/auth', 'app/data-context-auth'], factory);\n    }\n})(function (template, ko, auth, ctx, validate) {\n\n    \"use strict\";\n\n    function ViewModel() {\n\n        var self = this;\n\n        this.model = new Model();\n\n        this.message = ko.observable();\n        this.running = ko.observable(false);\n\n        self.submit = function (form) {\n\n            var args = this;\n\n            //if (!validate.valid(args, form)) {\n            //    return;\n            //}\n\n            self.running(true);\n\n            var response = ctx.login(this.email(), this.password());\n\n            response.then(function (response) {\n\n                auth.login(response.access_token, {}, response.expires_in);\n                auth.transferRedirect();\n\n                self.message(null);\n            })['catch'](function (error) {\n\n                try {\n\n                    var obj = JSON.parse(error.xhr.responseText);\n                    self.message(obj.error_description || obj.message);\n                } catch (e) {\n                    self.message('Sorry an error occured, please contact your administrator');\n                }\n            }).then(function () {\n\n                self.running(false);\n            });\n        };\n    }\n\n    function Model() {\n\n        this.email = ko.observable();\n        this.password = ko.observable();\n    }\n\n    return {\n        viewModel: ViewModel,\n        template: template\n    };\n});"],"sourceRoot":"/source/"}