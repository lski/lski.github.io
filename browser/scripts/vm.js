!function(e,t,n,a,o,i,l){function r(e){return j+e}function d(){x.file&&a.confirm("Are you sure you want to delete this file? \n\nIt could be being used on the website or in an email",function(t){t&&e.ajax({url:r("/api/browser/file?"+e.param({path:x.file},!0)),type:"DELETE",dataType:"json"}).done(function(){k(x.folder)})})}function c(t){t?(e(".file-selected",y).text(t),e(y).addClass("file-selected"),x.file=t,s(t)):(e(".file-selected",y).text(""),e(y).removeClass("file-selected"),x.file=null,f())}function s(e){p().dispatchEvent(new CustomEvent("file-selected",{bubbles:!0,cancelable:!1,detail:{path:e}}))}function f(){p().dispatchEvent(new CustomEvent("file-deselected",{bubbles:!0,cancelable:!1}))}function u(e){p().dispatchEvent(new CustomEvent("file-selected-complete",{bubbles:!0,cancelable:!1,detail:{path:e}}))}function p(){return o.frameElement}function b(){var t=e(this);t.siblings().removeClass("selected").end().addClass("selected"),c(null)}function h(){var t=e(this),n=t.data("path");c(n)}function m(){var t=e(this),n=t.data("path");u(n)}function w(){var t=e(".browser-folders"),n=t.jstree(!0),a=e(this).data("path"),o='[data-path="'+a+'"]';n.deselect_all(),n.select_node(t.find(o).parent().attr("id"))}function v(t){var n=e(".browser-folders").jstree({core:{data:E(t)}});n.on("select_node.jstree",g),n.on("ready.jstree",function(){n.jstree("select_node","#folder-item-Lw",!0)})}function g(e,t){var n=t.node.a_attr["data-path"];x.folder=n,k(n),e.stopPropagation()}function k(n){e.getJSON(r("/api/browser/folder/contents"),{path:n}).done(function(n){var a=e("<div/>"),o=t.template(e("#template").text());t(n).each(function(e){e.isFile&&e.isImage?e.icon=r(e.link):e.isFile?e.icon="content/images/blank-file-icon.png":e.icon="content/images/folder-icon.png";var t=o(e);a.append(t)}),e(".browser-contents").empty().append(a),c(null)})}function E(e){return{id:"folder-item-"+e.id,text:e.name,a_attr:{"data-path":e.path,"data-id":e.id},state:{opened:!0},children:t(e.directories).map(E)}}var y=e("#file-browser")[0],j=(e("[data-application-root]").data("application-root")||"").replace(/^\//,""),x={file:null,folder:null};n.on(y,"click",".item",b),n.on(y,"click",".item-file",h),n.on(y,"dblclick",".item-file",m),n.on(y,"dblclick",".item-folder",w),n.on(".toolbar .delete","click",d),e(".browser-contents",y).on("dragenter",function(){e(this).css({"background-color":"#efefef"})}).on("dragleave dragend drop",function(){e(this).css({"background-color":"transparent"})}),e('[type="file"]',y).fileupload({url:r("/api/browser/upload"),add:function(e,t){x.folder&&(t.formData={path:x.folder},t.submit())},done:function(e,t){k(x.folder)}}).on("fileuploadfail",function(e,t){try{a.alert(JSON.parse(arguments[1].xhr().responseText).message)}catch(n){a.alert("There was an error uploading the file")}}),e.getJSON(r("/api/browser/folder")).done(v)}(jQuery,_,window.lski.events,window.lski.alerts,window,document);
//# sourceMappingURL=../../maps/browser/scripts/vm.js.map
