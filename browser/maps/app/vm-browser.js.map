{"version":3,"sources":["app/vm-browser.js"],"names":["Browser","e","t","n","i","r","o","d","f","m","prepend","u","fire","h","file","p","frameElement","push","parent","g","S","updateSelected","find","removeClass","v","addClass","body","w","apiUrl","token","b","k","c","y","l","F","s","a","on","load","detail","folder","path","selectById","id","getSelectedFolderPath","fileupload","url","resolveApi","formData","submit","alert","JSON","parse","xhr","responseText","message","map","isFile","isImage","icon","link","reduce","append","render","empty","trigger","this","siblings","end","I","set","getAttribute","get","css","background-color","getFolderContent","then","name","directories","length","jstree","core","data","text","a_attr","data-path","data-id","class","state","opened","children","getPath","clear","has","node","stopPropagation","getFolderTree","done","confirm","deleteItem","attr","href","ajaxSetup","beforeSend","setRequestHeader","ajax","type","dataType","getJSON","prototype","jQuery","window","lski","events","alerts","document"],"mappings":"AAAA,YAAa,IAAIA,SAAQ,SAASC,EAAEC,EAAEC,EAAEC,EAAEC,GAAG,QAASC,GAAEA,EAAEC,GAAG,QAASC,KAAIC,EAAEC,QAAQ,6UAA6U,QAASC,GAAEV,GAAGC,EAAEU,KAAKC,IAAI,iBAAiBC,KAAKb,IAAI,QAASc,KAAIb,EAAEU,KAAKC,IAAI,mBAAmB,QAASA,KAAI,GAAIZ,IAAGQ,EAAE,GAAI,OAAOL,GAAEY,aAAaf,EAAEgB,KAAKb,EAAEY,cAAcZ,EAAEc,SAASd,GAAGH,EAAEgB,KAAKb,EAAEc,QAAQjB,EAAE,QAASkB,KAAIC,EAAEC,eAAe,MAAMZ,EAAEa,KAAK,sBAAsBC,YAAY,iBAAiB,QAASC,GAAEvB,GAAGmB,EAAEC,eAAepB,GAAGQ,EAAEa,KAAK,sBAAsBG,SAAS,iBAAiB,GAAIhB,GAAER,EAAEK,GAAGD,EAAEqB,MAAMC,EAAEpB,IAAIqB,OAAO,GAAGC,MAAM,KAAMrB,IAAI,IAAIsB,GAAE7B,EAAE,gBAAgBQ,GAAGsB,EAAE,GAAIC,GAAEL,EAAEC,OAAOD,EAAEE,OAAOI,EAAE,GAAIC,GAAEjC,EAAE,oBAAoBQ,GAAGsB,GAAGI,EAAE,GAAIC,GAAEnC,EAAE,mBAAmBQ,GAAGsB,GAAGX,EAAE,GAAIiB,GAAEpC,EAAE,WAAWQ,GAAGsB,EAAG7B,GAAEoC,GAAG7B,EAAE,6BAA6B,SAASR,GAAGgC,EAAEM,KAAKtC,EAAEuC,OAAOC,OAAOC,MAAMvB,MAAMjB,EAAEoC,GAAG7B,EAAE,gCAAgC,SAASR,GAAGkC,EAAEQ,WAAW1C,EAAEuC,OAAOC,OAAOG,IAAIzB,MAAMjB,EAAEoC,GAAG7B,EAAE,gCAAgC,SAASR,GAAGuB,EAAEvB,EAAEuC,OAAO1B,MAAMH,EAAEV,EAAEuC,OAAO1B,QAAQZ,EAAEoC,GAAG7B,EAAE,kCAAkC,WAAWU,IAAIJ,MAAMb,EAAEoC,GAAG7B,EAAE,2BAA2B,WAAWwB,EAAEM,KAAKJ,EAAEU,2BAA2Bf,EAAEgB,YAAYC,IAAIhB,EAAEiB,WAAW,yBAAyBV,GAAG,gBAAgB,SAASrC,EAAEC,GAAG,GAAIC,GAAEgC,EAAEU,uBAAwB1C,KAAID,EAAE+C,UAAUP,KAAKvC,GAAGD,EAAEgD,YAAYZ,GAAG,iBAAiB,WAAWL,EAAEM,KAAKJ,EAAEU,2BAA2BP,GAAG,iBAAiB,SAASrC,EAAEC,GAAG,IAAIC,EAAEgD,MAAMC,KAAKC,MAAMnD,EAAEoD,MAAMC,cAAcC,SAAS,MAAMpD,GAAGD,EAAEgD,MAAM,4CAA4C,QAASjB,GAAE/B,EAAEC,GAAG,QAASC,GAAEJ,GAAG,GAAIC,GAAED,EAAEwD,IAAI,SAASxD,GAAG,MAAOA,GAAEyD,QAAQzD,EAAE0D,QAAQ1D,EAAE2D,KAAK3D,EAAE4D,KAAK5D,EAAEyD,OAAOzD,EAAE2D,KAAK,qCAAqC3D,EAAE2D,KAAK,iCAAiC3D,GAAI,OAAOmB,GAAElB,EAAEgC,IAAIhC,EAAE,QAASI,GAAEJ,GAAG,GAAIC,GAAED,EAAE4D,OAAO,SAAS7D,EAAEC,GAAG,MAAOD,GAAE8D,OAAO,GAAIxD,GAAEL,GAAG8D,WAAW/D,EAAE,UAAW,OAAOkC,GAAE8B,QAAQF,OAAO5D,GAAGiC,IAAIlC,EAAE,QAASgC,KAAIhC,EAAEgE,QAAQ/B,EAAE,0BAA0B,QAASC,KAAIlC,EAAEgE,QAAQ/B,EAAE,8BAA8B,QAASE,GAAEpC,GAAGC,EAAEgE,QAAQ/B,EAAE,mCAAmCM,OAAOxC,IAAI,QAAS+B,GAAE/B,GAAGC,EAAEgE,QAAQ/B,EAAE,iCAAiCM,OAAOxC,IAAI,QAASO,GAAEP,GAAGC,EAAEgE,QAAQ/B,EAAE,iCAAiCrB,KAAKb,IAAI,QAASU,GAAEV,GAAGC,EAAEgE,QAAQ/B,EAAE,0CAA0CrB,KAAKb,IAAI,QAASc,GAAEd,GAAG,MAAOmB,GAAEE,KAAK,SAASpB,GAAG,MAAOA,GAAE0C,KAAK3C,IAAI,QAASY,KAAIZ,EAAEkE,MAAMC,WAAW7C,YAAY,YAAY8C,MAAM5C,SAAS,YAAY,QAASN,KAAI,GAAIlB,GAAE6B,EAAEqC,KAAMG,GAAEC,IAAItE,IAAIO,EAAEP,GAAG,QAASuB,KAAI,GAAIvB,GAAE6B,EAAEqC,KAAMxD,GAAEV,GAAG,QAASQ,KAAI,GAAIR,GAAE6B,EAAEqC,KAAMG,GAAEC,IAAItE,IAAIoC,EAAEpC,GAAG,QAAS0B,KAAI,GAAI1B,GAAE6B,EAAEqC,KAAMnC,GAAE/B,GAAG,QAAS6B,GAAE7B,GAAG,GAAIC,GAAED,EAAEuE,aAAa,UAAW,OAAOzD,GAAEb,GAAG,QAAS6B,KAAI,GAAI9B,GAAE,IAAKkE,MAAKM,IAAI,WAAW,MAAOxE,IAAGkE,KAAKI,IAAI,SAASrE,GAAG,MAAOA,IAAGD,GAAE,GAAIA,EAAEC,GAAG,MAAK,IAAK,GAAI+B,GAAE7B,EAAE+B,EAAEhC,CAAED,GAAEoC,GAAGH,EAAE,QAAQ,QAAQtB,GAAGX,EAAEoC,GAAGH,EAAE,QAAQ,aAAahB,GAAGjB,EAAEoC,GAAGH,EAAE,QAAQ,eAAe1B,GAAGP,EAAEoC,GAAGH,EAAE,WAAW,aAAaX,GAAGtB,EAAEoC,GAAGH,EAAE,WAAW,eAAeR,GAAGzB,EAAEoC,GAAGH,EAAE,YAAY,WAAWlC,EAAEkE,MAAMO,KAAKC,mBAAmB,cAAczE,EAAEoC,GAAGH,EAAE,yBAAyB,WAAWlC,EAAEkE,MAAMO,KAAKC,mBAAmB,iBAAkB,IAAIvD,MAAKkD,EAAE,GAAIvC,EAAEoC,MAAK5B,KAAK,SAAStC,GAAG,MAAOgC,GAAE2C,iBAAiB3E,GAAG4E,KAAKxE,GAAGwE,KAAKvE,IAAI,QAASC,GAAEN,GAAGkE,KAAKvB,GAAG3C,EAAE2C,GAAGuB,KAAKT,OAAOzD,EAAEyD,OAAOS,KAAKR,QAAQ1D,EAAE0D,QAAQQ,KAAKzB,KAAKzC,EAAEyC,KAAKyB,KAAKN,KAAK5D,EAAE4D,KAAKM,KAAKP,KAAK3D,EAAE2D,KAAKO,KAAKW,KAAK7E,EAAE6E,KAAK,QAAS1C,GAAEnC,EAAEE,GAAG,QAASC,GAAEH,GAAG,MAAOI,GAAEU,EAAEd,GAAG,QAASI,GAAEJ,EAAEC,GAAG,GAAGD,EAAE2C,KAAK1C,EAAE,MAAOD,EAAE,KAAI,GAAIE,GAAE,EAAEC,EAAEH,EAAE8E,YAAYC,OAAO5E,EAAED,EAAEA,IAAI,CAAC,GAAIG,GAAED,EAAEJ,EAAE8E,YAAY5E,GAAGD,EAAG,IAAGI,EAAE,MAAOA,GAAE,MAAO,MAAK,QAASA,GAAEL,GAAGC,EAAEgE,QAAQvD,EAAE,8BAA8B8B,OAAOxC,IAAI,QAASiC,GAAEjC,GAAGc,EAAEd,GAAG,KAAKM,EAAEN,GAAG,QAASM,GAAEN,GAAG,GAAIC,GAAES,EAAEsE,QAAQC,MAAMC,KAAK/C,EAAEnC,KAAMC,GAAEoC,GAAG,eAAe,WAAWN,EAAEW,WAAW,QAAQ,QAASP,GAAEnC,GAAG,OAAO2C,GAAG,eAAe3C,EAAE2C,GAAGwC,KAAKnF,EAAE6E,KAAKO,QAAQC,YAAYrF,EAAEyC,KAAK6C,UAAUtF,EAAE2C,GAAG4C,QAAQ,oBAAoBC,OAAOC,QAAO,GAAIC,UAAU1F,EAAE8E,iBAAiBtB,IAAIrB,IAAI,QAASC,KAAI,GAAIpC,GAAE,IAAKkE,MAAKM,IAAI,WAAW,MAAOxE,IAAGkE,KAAKyB,QAAQ,WAAW,MAAO3F,GAAEA,EAAEyC,KAAK,MAAMyB,KAAKI,IAAI,SAASrE,GAAG,MAAOA,IAAGD,GAAE,GAAIA,EAAEC,GAAG,MAAK,IAAKiE,KAAK0B,MAAM,WAAW5F,EAAE,MAAMkE,KAAK2B,IAAI,WAAW,MAAO,QAAO7F,GAAG,GAAI+B,GAAEmC,KAAK3D,EAAEL,EAAEQ,EAAEV,EAAEc,EAAE,KAAKF,EAAE,GAAIwB,EAAE1B,GAAE2B,GAAG,qBAAqB,SAASrC,EAAEC,GAAG,GAAIC,GAAED,EAAE6F,KAAKV,OAAO,WAAWhF,EAAED,EAAED,EAAGU,GAAE0D,IAAIlE,GAAGC,EAAED,GAAGJ,EAAE+F,oBAAoBxF,EAAEyF,gBAAgBC,KAAKhE,GAAGiC,KAAKxB,WAAW,SAAS1C,GAAGU,EAAEsE,OAAO,gBAAgBtE,EAAEsE,OAAO,cAActE,EAAEW,KAAK,aAAarB,EAAE,MAAMiB,WAAWiD,KAAKtB,sBAAsB,WAAW,MAAOhC,GAAE+E,WAAW,QAASvD,GAAEjC,EAAEC,GAAG,QAASC,KAAI0B,GAAG7B,EAAEgG,QAAQ,wEAAwE,SAASlG,GAAGA,GAAGmC,EAAEgE,WAAWpE,EAAEY,IAAIsD,KAAKhE,KAAK,QAASA,KAAIG,EAAEhB,eAAe,MAAMnB,EAAEgE,QAAQ3D,EAAE,4BAA4B,GAAIA,GAAEH,EAAEgC,EAAE/B,EAAEgC,EAAE8B,KAAKnC,EAAE,KAAKxB,EAAEP,EAAE,iBAAiBG,EAAGF,GAAEoC,GAAG/B,EAAE,QAAQ,UAAUD,GAAG6D,KAAK9C,eAAe,SAASpB,GAAGA,GAAG+B,EAAE/B,EAAEO,EAAE4E,KAAKnF,EAAE6E,MAAMtE,EAAE6F,MAAMC,KAAKrG,EAAE4D,SAAS7B,EAAE,KAAKxB,EAAE4E,KAAK,MAAM,QAASpD,GAAE9B,EAAEC,GAAG,QAASC,GAAEH,GAAG,MAAOI,GAAEJ,EAAE,GAAII,GAAEH,EAAEI,EAAE,gBAAiBH,GAAE,WAAW,MAAOA,IAAG,kBAAmBA,GAAEA,EAAE,IAAKG,IAAGL,EAAEsG,WAAWC,WAAW,SAASvG,GAAGA,EAAEwG,iBAAiB,gBAAgB,UAAUtG,QAAQgE,KAAKiC,WAAW,SAASlG,GAAG,MAAOD,GAAEyG,MAAM3D,IAAI3C,EAAE,qBAAqBF,GAAGyG,KAAK,SAASC,SAAS,UAAUzC,KAAKS,iBAAiB,SAAS1E,GAAG,MAAOD,GAAE4G,QAAQzG,EAAE,iCAAiCsC,KAAKxC,KAAKiE,KAAK8B,cAAc,WAAW,MAAOhG,GAAE4G,QAAQzG,EAAE,yBAAyB+D,KAAKnB,WAAW5C,EAAE,MAAOG,GAAEuG,UAAU9C,OAAO,WAAW,GAAI/D,GAAEkE,KAAKT,OAAO,aAAaS,KAAKR,QAAQ,cAAc,IAAI,cAAczD,EAAEiE,KAAKT,OAAOS,KAAKN,KAAKM,KAAKzB,KAAKvC,EAAE,oBAAoBF,EAAE,YAAYC,EAAE,cAAciE,KAAKvB,GAAG,mDAAmDuB,KAAKP,KAAK,6CAA6CO,KAAKW,KAAK,qBAAsB,OAAO3E,IAAGG,GAAGyG,OAAOC,OAAOC,KAAKC,OAAOF,OAAOC,KAAKE,OAAOH,OAAOI","file":"app/vm-browser.js","sourcesContent":["\"use strict\";var Browser=function(e,t,n,i,r){function o(o,d){function f(){m.prepend('<div class=\"file-browser\"><input type=\"file\" name=\"posted\" style=\"display:none;\" /><div class=\"browser\"><div class=\"browser-folders\"></div><div class=\"browser-contents\"></div></div><footer class=\"details\"><div><img class=\"delete\" src=\"content/images/close.png\" /><a class=\"file-selected\" target=\"_blank\"></a></div></footer></div>')}function u(e){t.fire(h(),\"file-selected\",{file:e})}function p(){t.fire(h(),\"file-deselected\")}function h(){var e=[m[0]];return i.frameElement?e.push(i.frameElement):i.parent!==i&&e.push(i.parent),e}function g(){S.updateSelected(null),m.find(\"> div.file-browser\").removeClass(\"file-selected\")}function v(e){S.updateSelected(e),m.find(\"> div.file-browser\").addClass(\"file-selected\")}var m=e(o||r.body),w=d||{apiUrl:\"\",token:null};f();var b=e('[type=\"file\"]',m),k=new c(w.apiUrl,w.token),y=new l(e(\".browser-contents\",m),k),F=new s(e(\".browser-folders\",m),k),S=new a(e(\".details\",m),k);t.on(m,\"folder-tree-folder-changed\",function(e){y.load(e.detail.folder.path),g()}),t.on(m,\"folder-contents-folder-opened\",function(e){F.selectById(e.detail.folder.id),g()}),t.on(m,\"folder-contents-file-selected\",function(e){v(e.detail.file),u(e.detail.file)}),t.on(m,\"folder-contents-folder-selected\",function(){g(),p()}),t.on(m,\"details-bar-item-deleted\",function(){y.load(F.getSelectedFolderPath())}),b.fileupload({url:k.resolveApi(\"/api/browser/upload\")}).on(\"fileuploadadd\",function(e,t){var n=F.getSelectedFolderPath();n&&(t.formData={path:n},t.submit())}).on(\"fileuploaddone\",function(){y.load(F.getSelectedFolderPath())}).on(\"fileuploadfail\",function(e,t){try{n.alert(JSON.parse(t.xhr().responseText).message)}catch(i){n.alert(\"There was an error uploading the file\")}})}function l(n,i){function r(e){var t=e.map(function(e){return e.isFile&&e.isImage?e.icon=e.link:e.isFile?e.icon=\"content/images/blank-file-icon.png\":e.icon=\"content/images/folder-icon.png\",e});return S=t,l(),t}function o(t){var n=t.reduce(function(e,t){return e.append(new d(t).render())},e(\"<div/>\"));return F.empty().append(n),s(),t}function l(){t.trigger(F,\"folder-contents-loaded\")}function s(){t.trigger(F,\"folder-contents-ui-updated\")}function a(e){t.trigger(F,\"folder-contents-folder-selected\",{folder:e})}function c(e){t.trigger(F,\"folder-contents-folder-opened\",{folder:e})}function f(e){t.trigger(F,\"folder-contents-file-selected\",{file:e})}function u(e){t.trigger(F,\"folder-contents-file-selected-complete\",{file:e})}function p(e){return S.find(function(t){return t.id===e})}function h(){e(this).siblings().removeClass(\"selected\").end().addClass(\"selected\")}function g(){var e=b(this);I.set(e)&&f(e)}function v(){var e=b(this);u(e)}function m(){var e=b(this);I.set(e)&&a(e)}function w(){var e=b(this);c(e)}function b(e){var t=e.getAttribute(\"data-id\");return p(t)}function k(){var e=null;this.get=function(){return e},this.set=function(t){return t==e?!1:(e=t||null,!0)}}var y=i,F=n;t.on(F,\"click\",\".item\",h),t.on(F,\"click\",\".item-file\",g),t.on(F,\"click\",\".item-folder\",m),t.on(F,\"dblclick\",\".item-file\",v),t.on(F,\"dblclick\",\".item-folder\",w),t.on(F,\"dragenter\",function(){e(this).css({\"background-color\":\"#efefef\"})}),t.on(F,\"dragleave dragend drop\",function(){e(this).css({\"background-color\":\"transparent\"})});var S=[],I=new k;this.load=function(e){return y.getFolderContent(e).then(r).then(o)}}function d(e){this.id=e.id,this.isFile=e.isFile,this.isImage=e.isImage,this.path=e.path,this.link=e.link,this.icon=e.icon,this.name=e.name}function s(e,n){function i(e){return r(p,e)}function r(e,t){if(e.id===t)return e;for(var n=0,i=e.directories.length;i>n;n++){var o=r(e.directories[n],t);if(o)return o}return null}function o(e){t.trigger(u,\"folder-tree-folder-changed\",{folder:e})}function l(e){p=e||null,d(e)}function d(e){var t=u.jstree({core:{data:s(e)}});t.on(\"ready.jstree\",function(){c.selectById(\"Lw\")})}function s(e){return{id:\"folder-item-\"+e.id,text:e.name,a_attr:{\"data-path\":e.path,\"data-id\":e.id,\"class\":\"tree-item-folder\"},state:{opened:!0},children:(e.directories||[]).map(s)}}function a(){var e=null;this.get=function(){return e},this.getPath=function(){return e?e.path:null},this.set=function(t){return t==e?!1:(e=t||null,!0)},this.clear=function(){e=null},this.has=function(){return null===e}}var c=this,f=n,u=e,p=null,h=new a;u.on(\"select_node.jstree\",function(e,t){var n=t.node.a_attr[\"data-id\"],r=i(n);h.set(r),o(r),e.stopPropagation()}),f.getFolderTree().done(l),this.selectById=function(e){u.jstree(\"deselect_all\"),u.jstree(\"select_node\",u.find('[data-id=\"'+e+'\"]').parent())},this.getSelectedFolderPath=function(){return h.getPath()}}function a(i,r){function o(){c&&n.confirm(\"Are you sure you want to delete this file? \\n\\nIt could be being used\",function(e){e&&s.deleteItem(c.id).done(l)})}function l(){a.updateSelected(null),t.trigger(d,\"details-bar-item-deleted\")}var d=i,s=r,a=this,c=null,f=e(\".file-selected\",i);t.on(d,\"click\",\".delete\",o),this.updateSelected=function(e){e?(c=e,f.text(e.name),f.attr({href:e.link})):(c=null,f.text(\"\"))}}function c(t,n){function i(e){return r+e}var r=t,o=\"string\"==typeof n?function(){return n}:\"function\"==typeof n?n:null;o&&e.ajaxSetup({beforeSend:function(e){e.setRequestHeader(\"Authorization\",\"Bearer \"+n())}}),this.deleteItem=function(t){return e.ajax({url:i(\"/api/browser/file/\"+t),type:\"DELETE\",dataType:\"json\"})},this.getFolderContent=function(t){return e.getJSON(i(\"/api/browser/folder/contents\"),{path:t})},this.getFolderTree=function(){return e.getJSON(i(\"/api/browser/folder\"))},this.resolveApi=i}return d.prototype.render=function(){var e=this.isFile?\"item-file\"+(this.isImage?\" item-image\":\"\"):\"item-folder\",t=this.isFile?this.link:this.path,n='<div class=\"item '+e+'\" title=\"'+t+'\" data-id=\"'+this.id+'\"><div class=\"item-icon\"><span></span><img src=\"'+this.icon+'\" /></div><div class=\"item-caption\"><span>'+this.name+\"</span></div></div>\";return n},o}(jQuery,window.lski.events,window.lski.alerts,window,document);"],"sourceRoot":"/source/"}